---
layout: notes
title: "Векторные базы данных"
lecture: "vector-databases-ann"
order: 1
description: "Обзор популярных векторных БД: Chroma, Qdrant, Milvus, Pinecone, Weaviate, PG-Vector"
estimated_reading: "15 мин"
---

# Векторные базы данных

## Chroma
- **Тип**: Open source, легковесная векторная база данных.
- **Популярность**: Большое комьюнити, простота использования.
- **Технологии**:
    - Хранение данных на основе SQLite.
    - Не поддерживает горизонтальное масштабирование (single instance).
    - Нет распределённости, в отличие от Milvus или Qdrant.
- **Поиск и фильтрация**:
    - Есть фильтрация и поиск по метаданным.
    - Фильтрация простая, не поддерживает вложенные структуры.
    - Ограничения фильтрации и поиска по метаданным не дают максимальной гибкости при работе с метаданными.
- **Алгоритмы поиска**:
    - Используется только один алгоритм — Hierarchical Navigable Small World (HNSW).
    - HNSW обеспечивает логарифмический поиск (аппроксимация поиска ближайших соседей).
- **Квантование**:
    - Не поддерживается квантование embeddings, хранящихся в базе.
- **Ограничения**:
    - Из-за своей простоты и отсутствия распределённости не подходит для случаев с высокой нагрузкой и продакшн-использования.
- **Use-case**:
    - Подходит для прототипов.

---

## Qdrant
- **Язык реализации**: Написана на Rust, что обеспечивает лучшую оптимизацию по памяти и безопасности.
- **Распределённость**:
    - Изначально построена как распределённая база данных.
    - Поддерживает шардирование и репликацию.
        - **Репликация**: одинаковые инстанции одной базы хранятся в нескольких местах.
        - **Шардирование**: общий объём данных (embeddings) делится на разные инстанции; при индексации происходит ребалансировка для равномерного распределения векторов.
- **Архитектура**:
    - Распределённый монолит — при горизонтальном масштабировании добавляется сразу весь instance, масштабируются все операции одновременно.
    - Нет возможности масштабировать отдельные типы операций (например, только чтение).
- **Алгоритмы поиска**:
    - Использует только один алгоритм аппроксимации поиска ближайших соседей — кастомную реализацию HNSW.
    - Может работать с объёмом данных, который превышает объём оперативной памяти (граф хранится на диске, в RAM подгружается по необходимости).
- **Фильтрация**:
    - Фильтрация по метаданным производится до поиска ближайших соседей (как и в Chroma).
    - Более гибкая фильтрация по метаданным, включая условия поиска хотя бы одного значения в массиве и др.
- **Квантование**:
    - Поддерживает квантование embeddings:
        - **Продуктовое квантование**: делит embeddings на сегменты, которые записываются в таблице.
        - **Скалярное квантование**: округление точности, например, с float32 до int8, что снижает объём памяти для хранения числа в 4 раза.
- **Use-case**:
    - Подходит для более production-ready решений по сравнению с Chroma.

---

## Milvus
- **Архитектура**:
    - Векторная база данных, построенная на микросервисах.
    - Каждый сервисный узел отвечает за отдельные операции: запись, чтение, поиск.
    - Масштабирование возможно по отдельным операциям: например, можно увеличить число узлов только для чтения или только для записи, в зависимости от нагрузки.
    - За счёт такой микросервисной архитектуры достигается высокая гибкость масштабирования.
    - В Qdrant такого нет: там масштабирование идёт за счёт увеличения числа инстансов, и все операции масштабируются одновременно (распределённый монолит).
- **Распределённость**:
    - Поддерживает шардирование и репликацию, что обеспечивает хорошую горизонтальную масштабируемость.
- **Алгоритмы поиска**:
    - Milvus не привязан к конкретной реализации алгоритма аппроксимации поиска ближайших соседей.
    - Поддерживаются любые современные алгоритмы: HNSW, FAISS, IVF.
- **Требования к развёртыванию**:
    - Из-за микросервисной архитектуры требуется определённая DevOps-компетенция для развёртывания и поддержки.
- **Use-case**:
    - Подходит для ещё более production-ready решений, чем Qdrant.

---

## Pinecone
- **Тип**: Проприетарное (SaaS) решение, в отличие от self-hosted баз данных (Chroma, Qdrant, Milvus).
- **Доступ**:
    - Доступно через API.
    - Использование — по подписке, оплата за сервис.
    - Вендор берет на себя все низкоуровневые настройки и обслуживание.
- **Масштабируемость**:
    - Поддерживает шардирование и репликацию.
    - Обеспечивает гибкую горизонтальную масштабируемость, все настройки выполняются через API.
- **Фильтрация и поиск**:
    - Поддерживает гибкую фильтрацию и поиск по метаданным, аналогично Qdrant.
- **Алгоритмы поиска**:
    - Конкретный алгоритм аппроксимации поиска ближайших соседей не раскрывается.
    - Скорее всего используется кастомная, адаптированная версия HNSW или другого графового алгоритма.
- **Use-case**:
    - Для тех, кому важна максимальная простота внедрения и отсутствие необходимости администрирования инфраструктуры.

---

## Weaviate
- **Язык реализации**: Написана на Go, что обеспечивает хорошую поддержку многопоточности.
- **Интерфейс**:
    - Использует интерфейс на основе GraphQL, а не REST.
    - Это даёт возможность строить более гибкие запросы и получать только необходимые поля данных.
- **Векторизация**:
    - Поддерживает построение эмбеддингов (векторизацию) внутри самой базы, в отличие от Qdrant, который ожидает на вход уже готовые эмбеддинги.
- **Cross-Reference**:
    - Поддерживает cross-функцию — объекты могут ссылаться друг на друга.
    - За счёт этого строится графовая структура связей между объектами.
    - Основная особенность — представление данных не просто как набор эмбеддингов, а как связанные объекты.
- **Распределённость**:
    - Поддерживает шардирование и репликацию, как и другие современные векторные базы данных.
- **Алгоритмы поиска**:
    - Реализует собственные алгоритмы аппроксимации поиска ближайших соседей, например, HNSW.
- **Use-case**:
    - Особенно хорошо подходит для наборов данных с явными связями (например, авторы книг и сами книги), а не только для плоских структур документов.
- **Ограничения**:
    - Несмотря на поддержку cross-ссылок, Weaviate не является полноценной графовой базой данных.
    - Наличие cross-ссылок позволяет строить некоторые knowledge-графы, но Weaviate не заменяет специализированные решения, такие как NEO4J, для реализации паттернов типа GraphRAG.

---

## PG-Vector
- **Тип**: Расширение для существующей базы данных PostgreSQL.
- **Особенности**:
    - Добавляет новые типы данных и функции для работы с векторами прямо в PostgreSQL.
    - Векторные данные могут храниться, например, в отдельных колонках таблиц.
- **Алгоритмы поиска**:
    - Для аппроксимации поиска ближайших соседей поддерживаются два алгоритма: HNSW и IVF (на выбор).
- **Use-case**:
    - Оптимально подходит для случаев, когда данные уже хранятся в структурированном (реляционном) виде в PostgreSQL.
    - Идеален для задач, где требуется интеграция векторного поиска с традиционными реляционными данными. 